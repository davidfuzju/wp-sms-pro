(()=>{"use strict";const e={addRightHandStep:function(e){const n=a.at(-1);a.push(e),c(),e.insertAfter(n??t.stepZero)},addLeftHandStep:function(e){const n=r.at(-1);r.push(e),c(),e.insertBefore(n??t.stepZero)},slideToStep:l},n={addSuccessNotice:function(e){const n=jQuery("#login > h1");jQuery(`<p class="message success">${e}</p>`).insertAfter(n)},addErrorNotice:function(e){const n=jQuery("#login > h1");jQuery(`<p class="message failure">${e}</p>`).insertAfter(n)},removeAllNotices:function(){jQuery("#login > h1").nextUntil(jQuery("div.login-form-container")).remove()},shakeElement:function(e){e.removeClass("shake"),window.setTimeout((function(){e.addClass("shake")}),50)}};var t,s,i;function o(e){return void 0===s&&(s=new Promise((n=>{const s=jQuery("#loginform");i=e,s.wrap('<div class="login-form-container"></div>'),s.wrap('<div class="login-form-steps-container"></div>'),s.wrap('<div class="login-form-step step-zero"></div>'),t={loginForm:s,stepsContainer:jQuery("div.login-form-steps-container"),stepZero:jQuery("div.login-form-step.step-zero")},n()}))),s}let a=[],r=[];function l(e){let n=i.options.is_rtl_page?"margin-right":"margin-left";switch(Math.sign(e)){case 1:var s=r.length+Math.abs(e);t.stepsContainer.css(n,-100*s+"%");break;case-1:s=r.length-Math.abs(e);t.stepsContainer.css(n,-100*s+"%");break;case 0:const i=r.length;t.stepsContainer.css(n,`-${100*i}%`)}const o=new Promise((e=>setTimeout(e,400)));return t.stepsContainer.triggerHandler("slide",[e,o]),o}function c(){const e=r.length+a.length+1;t.stepsContainer.css({css:"",width:100*e+"%"}),l(0).then((()=>t.stepsContainer.css("transition","margin 0.3s ease-in-out")))}class d extends EventTarget{constructor(e){super(),this.containerElem=e,this.inputField=this.containerElem.children(".otp-digit-input")}init(){return this.inputField.on("keydown",(e=>{let n=e.key;"Enter"==n?this.dispatchEvent(new CustomEvent("submit",{detail:{code:this.getCode()}})):n.match(/^[0-9]$/)?this.inputField.removeClass("focus-error error"):this.inputField.addClass("focus-error")})),this.dispatchEvent(new Event("initialized")),this}getCode(){let e="",n=!0,t=this.inputField.val();return t||(this.dispatchEvent(new Event("invalidInput")),jQuery(this.inputField).addClass("error"),n=!1),e+=void 0!==t?String(t):"",!!n&&e}clean(){this.inputField.val(null),this.inputField.removeClass("error")}focusInput(){this.inputField.trigger("focus")}addErrorClassToInput(){this.inputField.addClass("error")}}const p={init:function(s){void 0===m&&(m=new Promise((i=>{u={...t},h=s,function(){const n=jQuery(`\n            <div class="or-login-with-wp-sms-otp-section">\n                <div class=or-separator>\n                    <span class="line"></span>\n                    <p>${h.l10n.or}</p>\n                    <span class="line"></span>\n                </div>\n                <button class="login-with-wp-sms-otp wpsms-button" type="button">\n                    <span class="icon dashicons dashicons-email-alt"></span>\n                    ${h.l10n.login_button_text}\n                </button>\n            </div>\n        `);n.insertAfter(u.loginForm);const t=n.children("button.login-with-wp-sms-otp");t.on("click",(()=>e.slideToStep(1))),u={...u,loginWithSmsButton:t}}(),function(){const t=jQuery(`\n            <div class="login-form-step second-step">\n                <h2 class="title">${h.l10n.login_with_sms_title}</h2>\n                <h6>${h.l10n.login_with_sms_number_subtitle}</h6>\n                <div class="input-box">       \n                    <label for="phoneNumber">${h.l10n.phone_number_field_label}</label>\n                    ${h.elements.mobile_field}\n                </div>    \n                <button class="request-otp-button wpsms-button">\n                    <span class="spinner"></span>\n                    <span>${h.l10n.request_otp_button_text}</span>\n                </button>\n                <div class=or-separator>\n                    <span class="line"></span>\n                    <p>${h.l10n.or}</p>\n                    <span class="line"></span>\n                </div>\n                <a class="or-login-regularly">\n                    <span class="icon dashicons dashicons-arrow-left-alt"></span>\n                    ${h.l10n.login_with_email_text}\n                </a>\n            </div>\n        `);let s;e.addRightHandStep(t);const i=t.children(".or-login-regularly"),o=t.children(".request-otp-button"),a=jQuery("#phoneNumber").extend({getPhoneNumber(){return null==s&&void 0!==window.intlTelInput&&(s=window.intlTelInput.getInstance(a.get(0))),null==s?this.val().replace(/[-\s]/g,""):s.isValidNumber()?s.getNumber():""}});i.on("click",(n=>e.slideToStep(0))),a.on("keydown",(e=>{"Enter"==e.key&&o.trigger("click")})),u.stepsContainer.on("slide",((e,n,t)=>{1==n&&t.then((()=>{a.trigger("focus")}))})),o.on("click",(t=>{o.hasClass("loading")||v()&&(o.addClass("loading"),function(e){const n=h.endPoints.request_otp,t={phone_number:e};h.recaptcha.site_key&&window.grecaptcha&&(t.recaptcha_response=grecaptcha.getResponse());return jQuery.ajax({method:n.method,url:n.url,data:t,headers:{[n.nonce_header_key]:n.nonce}})}(a.getPhoneNumber()).done((t=>{n.removeAllNotices(),n.addSuccessNotice(t.message),e.slideToStep(2),g=void 0!==t.is_new&&t.is_new})).fail((e=>{n.removeAllNotices(),n.addErrorNotice(e.responseJSON.message),n.shakeElement(u.stepsContainer)})).always((()=>{"undefined"!=typeof grecaptcha&&grecaptcha.reset(),setTimeout((()=>o.removeClass("loading")),500)})))})),u={...u,secondSlide:t,loginWithEmailButton:i,requestCodeBtn:o,phoneNumberField:a}}(),function(){const t=jQuery(`\n            <div class="login-form-step third-step">\n                <h2 class="title">${h.l10n.login_with_sms_title}</h2>\n                <h6>${h.l10n.login_with_sms_code_subtitle}</h6>\n                <div class="otp-input login-otp">\n                    <label>${h.l10n.login_with_sms_code_label}</label>\n                    <input class="otp-digit-input" type="text" maxlength="6">\n                </div>\n                <button class="verify-sms-otp wpsms-button" type="button">\n                    <span class="spinner"></span>\n                    <span>${h.l10n.login_button_text}</span>\n                </button>\n                <div class="request-new-code">\n                    <p>${h.l10n.request_new_code_text}</p>\n                    <a>\n                        <span class="icon dashicons dashicons-email-alt"></span>\n                        ${h.l10n.request_new_code_link}\n                    </a>\n                </div>\n            </div>\n        `);e.addRightHandStep(t);const s=new d(t.children(".otp-input.login-otp")).init(),i=t.children(".verify-sms-otp"),o=t.children(".request-new-code");u.stepsContainer.on("slide",((e,n,t)=>{2==n&&t.then((()=>{u.otpContainer.focusInput()}))})),s.addEventListener("submit",(()=>i.trigger("click"))),s.addEventListener("invalidInput",(e=>{n.removeAllNotices(),n.addErrorNotice(h.l10n.please_fill_digits_notice),setTimeout((()=>i.removeClass("loading")),500)})),i.on("click",(e=>{const t=u.otpContainer.getCode();0!=t&&(i.hasClass("loading")||v()&&(i.addClass("loading"),function(e,n){const t=h.endPoints.login_with_otp;return jQuery.ajax({method:t.method,url:t.url,data:{phone_number:e,code:n,is_new:g},headers:{[t.nonce_header_key]:t.nonce}})}(u.phoneNumberField.getPhoneNumber(),t).done((e=>{n.removeAllNotices(),n.addSuccessNotice(e.message),setTimeout((()=>{window.location.replace(e.redirect_to)}),500)})).fail((e=>{n.removeAllNotices(),n.addErrorNotice(e.responseJSON.message),n.shakeElement(u.stepsContainer),u.otpContainer.addErrorClassToInput(),u.otpContainer.focusInput()})).always(setTimeout((()=>i.removeClass("loading")),500))))})),o.on("click",(()=>{e.slideToStep(1).then((()=>{u.otpContainer.clean()}))})),u={...u,thirdSlide:t,otpContainer:s,verificationBtn:i,requestNewCodeBtn:o}}(),i()})));return m},initRecaptcha:function(){const e=jQuery('<div class="wp-sms-login-form-recaptcha"></div>').insertBefore(u.requestCodeBtn);h.recaptchaId=grecaptcha.render(e.get(0),{sitekey:h.recaptcha.site_key})}};var u,h,m,g=!1;function v(){return""!=u.phoneNumberField.getPhoneNumber()||(n.removeAllNotices(),n.addErrorNotice(h.l10n.invalid_phone_number),n.shakeElement(u.stepsContainer),!1)}const _={init:function(s){void 0===b&&(b=new Promise((i=>{f={...t},w=s,f.loginForm.on("submit",(t=>{if(C)return;t.preventDefault();const s=jQuery("#wp-submit");s.hasClass("loading")||(s.addClass("loading"),jQuery('<span class="spinner active"></span>').insertBefore(s),N().done((t=>{C=!0,t.userNeedsVerification?(n.removeAllNotices(),n.addSuccessNotice(t.message),e.slideToStep(-1).then((()=>{f.otpContainer.focusInput()}))):f.loginForm.trigger("submit")})).always((()=>{s.removeClass("loading").siblings(".spinner").remove()})))})),function(){const t=jQuery(`\n        <div class="login-form-step two-factor-auth">\n            <h2 class="title">${w.l10n.two_factor_auth_title}</h2>\n            <h6>${w.l10n.two_factor_auth_subtitle}</h6>\n            <div class="otp-input two-factor-otp">\n                <label>${w.l10n.verification_code_label}</label>\n                <input class="otp-digit-input" type="text" maxlength="6">\n            </div>\n            <button class="submit-two-factor-otp wpsms-button" type="button">\n                <span class="spinner"></span>\n                <span>${w.l10n.submit_button_text}</span>\n            </button>\n            <div class="request-new-code">\n                <p>${w.l10n.request_new_code_text}</p>\n                <a>\n                    <span class="icon dashicons dashicons-email-alt"></span>\n                    ${w.l10n.request_new_code_link}\n                </a>\n            </div>\n        </div>\n    `);e.addLeftHandStep(t);const s=new d(t.children(".otp-input.two-factor-otp")).init(),i=t.children(".submit-two-factor-otp"),o=t.children(".request-new-code");s.addEventListener("submit",(e=>i.trigger("click"))),s.addEventListener("invalidInput",(e=>{n.removeAllNotices(),n.addErrorNotice(w.l10n.please_fill_digits_notice)})),i.on("click",(e=>{const n=s.getCode();n&&function(e){f.loginForm.append(jQuery('<input type="hidden" name="wpsms_two_factor_auth_code">').val(e)).trigger("submit")}(n)})),o.on("click",(e=>{o.attr("is-clicked")||(f.otpContainer.clean(),o.attr("is-clicked",!0),N().done((e=>{n.removeAllNotices(),n.addSuccessNotice(e.message)})).fail((e=>{if(n.removeAllNotices(),n.shakeElement(f.stepsContainer),e.responseJSON)for(let t in e.responseJSON)n.addErrorNotice(e.responseJSON[t])})).always((()=>o.removeAttr("is-clicked"))))})),f={...f,otpContainer:s,submitBtn:i,requestNewCodeBtn:o}}(),i()})));return b}};var f,w,b;var y,C=!1;function N(){const e=w.endPoints.request_code;return jQuery.ajax({method:e.method,url:e.url,data:{user_login:jQuery("#user_login").val(),user_pass:jQuery("#user_pass").val()},headers:{[e.nonce_header_key]:e.nonce}}).fail((e=>{if(n.removeAllNotices(),n.shakeElement(f.stepsContainer),e.responseJSON)for(let t in e.responseJSON)n.addErrorNotice(e.responseJSON[t])}))}document.addEventListener("DOMContentLoaded",(async()=>{"undefined"!=typeof WPSmsProLoginWithSmsData&&(await o(WPSmsProLoginWithSmsData),y=p.init(WPSmsProLoginWithSmsData)),"undefined"!=typeof WPSmsLoginFormTwoFactorAuthData&&(await o(WPSmsLoginFormTwoFactorAuthData),_.init(WPSmsLoginFormTwoFactorAuthData))})),window.WPSmsProLoginFormLoadRecaptcha=function(){y.then(p.initRecaptcha())}})();